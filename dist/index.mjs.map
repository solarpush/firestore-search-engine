{"version":3,"file":"index.mjs","sources":["../src/indexes/Indexes.ts","../src/shared/generateTypos.ts","../src/shared/levenshteinDistance.ts","../src/search/Search.ts","../src/shared/generateCharArray.ts","../src/utils/objects/deepEqual.ts","../src/shared/getDiffFromDocumentUpdate.ts","../src/FirestoreSearchEngine.ts"],"sourcesContent":[null,null,null,null,null,null,null,null],"names":["Indexes","constructor","firestoreInstance","config","props","this","wordMaxLength","wordMinLength","execute","typos","input","maxLength","length","Error","Set","segmentSizes","keyboardNeighbors","a","z","e","r","t","y","u","i","o","p","q","s","d","f","g","h","j","k","l","m","size","start","segment","slice","firstLetter","forEach","neighbor","typo","add","trim","_a","lastLetter","_b","fse_generateTypos","inputField","saveWithLimitedKeywords","returnedFields","Array","from","keywords","bulk","bulkWriter","cleanOldIndexes","keywordChunks","push","create","collection","doc","search_keywords","flush","close","indexedDocumentPath","query","where","get","empty","docs","delete","ref","fse_levenshteinDistance","b","matrix","_","fill","cost","Math","min","Search","limit","search","fieldValue","searchKeywords","startIndex","fragments","split","word","substring","toLowerCase","console","log","fse_generateCharArray","querySnapshot","uniqueDocs","results","data","rest","uniqueId","keyword","words","isCloseEnough","closeRelevance","distanceTotal","distance","Infinity","has","relevance","sort","map","result","deepEqual","Timestamp","isEqual","keysA","Object","keys","keysB","key","includes","getDiffFromUpdatedData","before","after","changes","added","removed","typedKey","afterValue","beforeValue","undefined","change","JSON","stringify","FirestoreSearchEngine","settings","ignoreUndefinedProperties","indexes","expressWrapper","app","path","startsWith","async","request","response","searchValue","params","json","onRequestWrapped","req","res","onCallWrapped","authCallBack","auth","HttpsError","onDocumentWriteWrapper","onDocumentWrittenCallBack","documentProps","documentsPath","eventHandlerOptions","document","event","updatedFieldValue","indexedKey","returnedKey","error","onDocumentUpdateWrapper","instanceOfOnDocumentUpdated","onDocumentDeletedWrapper","instanceOfOnDocumentDeleted","querySnap","index"],"mappings":"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"}