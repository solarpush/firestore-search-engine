{"version":3,"file":"index.cjs","sources":["../src/shared/vectorize.ts","../src/indexes/Indexes.ts","../src/indexes/IndexesAll.ts","../src/shared/levenshteinDistance.ts","../src/search/Search.ts","../src/shared/rankResults.ts","../src/utils/objects/deepEqual.ts","../src/shared/getDiffFromDocumentUpdate.ts","../src/FirestoreSearchEngine.ts"],"sourcesContent":[null,null,null,null,null,null,null,null,null],"names":["async","fse_vectorizeText","text","documents","embeddings","FlagEmbedding","init","model","EmbeddingModel","BGEBaseEN","embed","vectors","next","finalVector","value","length","Array","from","Indexes","constructor","firestoreInstance","fieldValueInstance","config","props","this","wordMaxLength","wordMinLength","execute","typos","inputField","saveWithLimitedKeywords","returnedFields","keywords","bulk","bulkWriter","cleanOldIndexes","create","collection","doc","search_keywords","vector","close","indexedDocumentPath","query","where","get","empty","j","docs","delete","ref","flush","IndexesAll","documentProps","documentsToIndexes","readyToBulk","element","indexedKey","fieldValue","toLowerCase","key","returnedKey","console","log","push","bulkWithLimitedKeywords","bulkData","bulkCount","document","fse_levenshteinDistance","a","b","matrix","_","i","fill","cost","Math","min","Search","limit","search","time","queryVector","querySnapshot","collectionGroup","findNearest","vectorField","distanceMeasure","distanceThreshold","distanceResultField","timeEnd","uniqueDocs","Set","results","data","uniqueId","has","add","ranked","map","result","textSimilarityScore","c","d","e","f","g","h","textSimilarityScoreReverse","reverse","join","distanceScore","distance","finalScore","sort","fse_rankResults","topResults","deepEqual","Timestamp","isEqual","keysA","Object","keys","keysB","includes","getDiffFromUpdatedData","before","after","changes","added","removed","forEach","typedKey","afterValue","beforeValue","undefined","settings","ignoreUndefinedProperties","Error","indexes","indexesAll","docProps","indexesConfig","expressWrapper","app","path","startsWith","request","response","searchValue","params","json","onRequestWrapped","req","res","onCallWrapped","authCallBack","auth","HttpsError","onDocumentWriteWrapper","onDocumentWrittenCallBack","documentsPath","eventHandlerOptions","event","_a","updatedFieldValue","_b","error","onDocumentUpdateWrapper","instanceOfOnDocumentUpdated","onDocumentDeletedWrapper","instanceOfOnDocumentDeleted","querySnap","index"],"mappings":"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"}